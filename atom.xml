<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æ­ªè„–å­é¹…çš„åšå®¢</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2017-09-06T16:30:45.000Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>æ­ªè„–å­é¹…</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ä¸¤ç§æ–¹æ³•å®ç°æ”¶è—æˆ–è€…ç‚¹èµåŠŸèƒ½</title>
    <link href="http://yoursite.com/2017/09/07/%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0%E6%94%B6%E8%97%8F%E6%88%96%E8%80%85%E7%82%B9%E8%B5%9E%E5%8A%9F%E8%83%BD/"/>
    <id>http://yoursite.com/2017/09/07/ä¸¤ç§æ–¹æ³•å®ç°æ”¶è—æˆ–è€…ç‚¹èµåŠŸèƒ½/</id>
    <published>2017-09-06T16:30:24.000Z</published>
    <updated>2017-09-06T16:30:45.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ”¶è—åŠŸèƒ½ä¸ç‚¹èµåŠŸèƒ½çš„å®ä½œååˆ†ç±»ä¼¼ï¼Œæœ¬æ–‡ä»¥è´­ç‰©è½¦æ•™ç¨‹å®ä½œæ”¶è—åŠŸèƒ½ä¸ºä¾‹ã€‚</p><h3 id="æ–¹æ³•ä¸€ï¼š"><a href="#æ–¹æ³•ä¸€ï¼š" class="headerlink" title="æ–¹æ³•ä¸€ï¼š"></a>æ–¹æ³•ä¸€ï¼š</h3><h5 id="step1"><a href="#step1" class="headerlink" title="step1"></a>step1</h5><p>ä¸€ä¸ªç”¨æˆ·å¯ä»¥æ”¶è—å¤šä¸ªå•†å“ï¼Œä¸€ä¸ªå•†å“å¯ä»¥è¢«æ”¶è—å¾ˆå¤šæ¬¡ï¼Œå› æ­¤è¿™æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ã€‚å› æ­¤éœ€è¦æ–°å¢ä¸€ä¸ªmodelï¼Œæ¥å½“åšproductä¸suerçš„æ¡¥æ¢ã€‚<code>$ rails g model collect user_id:integer product_id:integer</code>,ç„¶åæ‰§è¡Œ <code>rake db:migrate</code>ï¼Œç„¶åä¸ºcollectã€userä¸productè¿™ä¸‰ä¸ªmodelåŠ ä¸Šå…³è”ã€‚</p><figure class="highlight ruby"><figcaption><span>app/models/collect.rb</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">   + belongs_to <span class="symbol">:user</span></div><div class="line">   + belongs_to <span class="symbol">:product</span></div><div class="line"><span class="string">``</span><span class="string">`   </span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">`</span><span class="string">``</span> ruby app/models/product.rb</div><div class="line">   + has_many <span class="symbol">:collects</span></div><div class="line">   + has_many <span class="symbol">:collected_users</span>, <span class="symbol">through:</span> <span class="symbol">:collects</span>, <span class="symbol">source:</span> <span class="symbol">:user</span></div></pre></td></tr></table></figure><figure class="highlight ruby"><figcaption><span>app/models/user.rb</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">   + has_many <span class="symbol">:collects</span></div><div class="line">   + has_many <span class="symbol">:collected_products</span>, <span class="symbol">through:</span> <span class="symbol">:collects</span>, <span class="symbol">source:</span> <span class="symbol">:product</span></div><div class="line"></div><div class="line">   <span class="comment">#åŠ ä¸Šæ˜¯å¦æ”¶è—å•†å“çš„åˆ¤å®š</span></div><div class="line">   + <span class="function"><span class="keyword">def</span> <span class="title">is_collect_of?</span><span class="params">(product)</span></span></div><div class="line">   +  collected_products.<span class="keyword">include</span>?(product)</div><div class="line">   + <span class="keyword">end</span></div><div class="line"><span class="string">``</span><span class="string">`    </span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">#### step2</span></div><div class="line"><span class="string">é¦–å…ˆä¿®æ”¹è·¯ç”±ä¿¡æ¯ï¼š</span></div><div class="line"><span class="string">`</span><span class="string">``</span> ruby config/routes.rb</div><div class="line">  + resources <span class="symbol">:product</span> <span class="keyword">do</span></div><div class="line">   +  member <span class="keyword">do</span></div><div class="line">   +    post <span class="symbol">:collect</span></div><div class="line">   +    post <span class="symbol">:uncollect</span></div><div class="line">   + <span class="keyword">end</span></div><div class="line"> +  <span class="keyword">end</span></div></pre></td></tr></table></figure><p>åœ¨controlleré‡ŒåŠ ä¸Šå¯¹åº”çš„methodï¼Œ</p><figure class="highlight ruby"><figcaption><span>app/controllers/product_controllers.rb</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">+ <span class="function"><span class="keyword">def</span><span class="title">collect</span></span></div><div class="line"> + @product = Product.find(params[<span class="symbol">:id</span>])</div><div class="line"> + current_user.collected_products &lt;&lt; @product</div><div class="line"> + flash[<span class="symbol">:notice</span>] = <span class="string">"æˆåŠŸæ”¶è—å•†å“"</span></div><div class="line"> + redirect_to <span class="symbol">:back</span></div><div class="line">+ <span class="keyword">end</span></div><div class="line"></div><div class="line">+ <span class="function"><span class="keyword">def</span> <span class="title">uncollect</span></span></div><div class="line"> + @product = Product.find(params[<span class="symbol">:id</span>])</div><div class="line"> + currrent_user.collected_products.delete(@product)</div><div class="line"> + flash[<span class="symbol">:warning</span>] = <span class="string">"æ‚¨å·²å–æ¶ˆæ”¶è—è¯¥å•†å“"</span></div><div class="line"> + redirect_to <span class="symbol">:back</span></div><div class="line">+ <span class="keyword">end</span></div></pre></td></tr></table></figure><h4 id="step3"><a href="#step3" class="headerlink" title="step3"></a>step3</h4><p>åœ¨viewsä¸­çš„ç›¸åº”ä½ç½®åŠ å…¥æ”¶è—çš„æ˜¾ç¤º</p><figure class="highlight ruby"><figcaption><span>app/views/products/show.html.erb</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">+ &lt;% <span class="keyword">if</span> current_user &amp;&amp; current_user.is_collect_of?(@product) %&gt;</div><div class="line">+  &lt;%= link_to(â€œå–æ¶ˆæ”¶è—â€, uncollect_product_path(@product), <span class="symbol">:method</span> =&gt; <span class="symbol">:post</span>, <span class="class"><span class="keyword">class</span>: "<span class="title">btn</span> <span class="title">btn</span>-<span class="title">danger</span> <span class="title">btn</span>-<span class="title">lg</span>" )%&gt;</span></div><div class="line">+ &lt;% <span class="keyword">else</span> %&gt;</div><div class="line">+  &lt;%= link_to(<span class="string">"æ”¶è—â€œ, collect_product_path(@product), :method =&gt; :post, class: "</span>btn btn-danger btn-lg<span class="string">" )%&gt;</span></div><div class="line"><span class="string">+ &lt;% end %&gt;</span></div></pre></td></tr></table></figure><h3 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h3><h4 id="step1-1"><a href="#step1-1" class="headerlink" title="step1"></a>step1</h4><p>åŒæ ·ï¼Œç»ˆç«¯æ‰§è¡Œ <code>rails g model colloect</code>, ç¼–è¾‘ <code>db/migrate/XXXXXXXX_create_collects.rb</code><br><figure class="highlight ruby"><figcaption><span>db/migrate/XXXXXXXX_create_collects.rb    </span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">  <span class="class"><span class="keyword">class</span> <span class="title">CreateCollects</span> &lt; ActiveRecord::Migration[5.0]</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">change</span></span></div><div class="line">      create_table <span class="symbol">:collects</span> <span class="keyword">do</span> <span class="params">|t|</span></div><div class="line">+       t.integer <span class="symbol">:user_id</span>, <span class="symbol">:index</span> =&gt; <span class="literal">true</span></div><div class="line">+       t.integer <span class="symbol">:product_id</span>, <span class="symbol">:index</span> =&gt; <span class="literal">true</span></div><div class="line">        t.timestamps</div><div class="line">      <span class="keyword">end</span></div><div class="line">    <span class="keyword">end</span></div><div class="line">  <span class="keyword">end</span></div></pre></td></tr></table></figure></p><p>ä¹‹åæ‰§è¡Œ <code>rake db:migrate</code></p><p>ç¼–è¾‘<code>app/models/collect.rb</code>,åŠ ä¸Šå…³è”<br><figure class="highlight ruby"><figcaption><span>app/models/collect.rb</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">+ belongs_to <span class="symbol">:user</span></div><div class="line">+ belongs_to <span class="symbol">:product</span></div></pre></td></tr></table></figure></p><p>ç¼–è¾‘ <code>app/models/product.rb</code>,åŠ ä¸Šå…³è”<br><figure class="highlight ruby"><figcaption><span>app/models/product.rb</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">  + has_many <span class="symbol">:collects</span>, <span class="symbol">:dependent</span> =&gt; <span class="symbol">:destroy</span></div><div class="line">  + had_many <span class="symbol">:collected_users</span>, <span class="symbol">through:</span> <span class="symbol">:collects</span>, <span class="symbol">source:</span> <span class="symbol">:user</span></div><div class="line"></div><div class="line">  + <span class="function"><span class="keyword">def</span> <span class="title">find_collect</span><span class="params">(user)</span></span></div><div class="line">   +  <span class="keyword">self</span>.collects.where( <span class="symbol">:user_id</span> =&gt; user.id).first</div><div class="line">  + <span class="keyword">end</span></div><div class="line"><span class="string">``</span><span class="string">`  </span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">ç¼–è¾‘ `</span>app/model/user.rb<span class="string">`,åŠ ä¸Šå…³è”</span></div><div class="line"><span class="string">`</span><span class="string">``</span> ruby app/models/user.rb</div><div class="line">  +  has_many <span class="symbol">:collects</span>, <span class="symbol">:dependent</span> =&gt; <span class="symbol">:destroy</span></div><div class="line">  +  has_many <span class="symbol">:collected_products</span>, <span class="symbol">through:</span> <span class="symbol">:collects</span>,  <span class="symbol">source:</span> <span class="symbol">:product</span></div></pre></td></tr></table></figure></p><h4 id="step2"><a href="#step2" class="headerlink" title="step2"></a>step2</h4><p>ç¼–è¾‘è·¯ç”±ä¿¡æ¯<br><figure class="highlight ruby"><figcaption><span>config/routes.rb</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">+ resource <span class="symbol">:products</span> <span class="keyword">do</span></div><div class="line">+   member <span class="keyword">do</span></div><div class="line">+     post <span class="symbol">:collect</span></div><div class="line">+     post <span class="symbol">:uncollect</span></div><div class="line">+   <span class="keyword">end</span></div><div class="line">+ <span class="keyword">end</span></div></pre></td></tr></table></figure></p><p>åœ¨controllerä¸­æ·»åŠ ï¼š<br><figure class="highlight ruby"><figcaption><span>app/controllers/product_controller.rb</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">+ <span class="function"><span class="keyword">def</span> <span class="title">collect</span></span></div><div class="line">  + @product = Product.find(params[<span class="symbol">:id</span>])    </div><div class="line">  + <span class="keyword">unless</span> @product.find_collect(cuurent_user)</div><div class="line">  +   Collect.create( <span class="symbol">:user</span> =&gt; current_user, <span class="symbol">:product</span> =&gt; @product)</div><div class="line">  + flash[<span class="symbol">:notice</span>] = <span class="string">"æ‚¨å·²æˆåŠŸæ”¶è—è¯¥å•†å“"</span></div><div class="line">  + <span class="keyword">end</span></div><div class="line">  + redirect_to <span class="symbol">:back</span></div><div class="line">+ <span class="keyword">end</span></div><div class="line"></div><div class="line">+ <span class="function"><span class="keyword">def</span> <span class="title">uncollect</span></span></div><div class="line">   + @product = Product.find(params[<span class="symbol">:id</span>])</div><div class="line">   + collect = @product.find_collect(current_user)</div><div class="line">   + collect.destroy</div><div class="line">   + flash[<span class="symbol">:warning</span>] = <span class="string">"æ‚¨å·²å–æ¶ˆæ”¶è—è¯¥å•†å“"</span></div><div class="line">   + redirect_to <span class="symbol">:back</span></div><div class="line">+ <span class="keyword">end</span></div></pre></td></tr></table></figure></p><h3 id="Step3"><a href="#Step3" class="headerlink" title="Step3"></a>Step3</h3><p>æœ€åä¸€æ­©ï¼Œå°±æ˜¯è¦åœ¨ <code>app/views/products/show.html.erb</code>ä¸­åŠ ä¸Šæ”¶è—çš„æŒ‰é’®</p><figure class="highlight ruby"><figcaption><span>app/views/products/show.html.erb</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">â€¦â€¦ç•¥</div><div class="line"> + &lt;% <span class="keyword">if</span> current_user %&gt;</div><div class="line"> +   &lt;% <span class="keyword">if</span> @product.find_collect(current_user)%&gt;</div><div class="line"> +     &lt;% =link_to(<span class="string">"å–æ¶ˆæ”¶è—"</span>, uncollect_product_path(@product), <span class="symbol">:method</span> =&gt; <span class="symbol">:post</span>, <span class="class"><span class="keyword">class</span>: "<span class="title">btn</span> <span class="title">btn</span>-<span class="title">danger</span> <span class="title">btn</span>-<span class="title">lg</span>")%&gt;</span></div><div class="line"> +   &lt;% <span class="keyword">else</span> %&gt;</div><div class="line"> +     &lt;%= link_to(<span class="string">"æ”¶è—"</span>, collect_product_path(@product), <span class="symbol">:method</span> =&gt; <span class="symbol">:post</span>, <span class="class"><span class="keyword">class</span>: "<span class="title">btn</span> <span class="title">btn</span>-<span class="title">primary</span> <span class="title">btn</span>-<span class="title">lg</span>")%&gt;</span></div><div class="line"> +   &lt;% <span class="keyword">end</span> %&gt;</div><div class="line"> + &lt;% <span class="keyword">end</span> %&gt;</div><div class="line">â€¦â€¦ç•¥</div></pre></td></tr></table></figure><h3 id="æˆæœå±•ç¤º"><a href="#æˆæœå±•ç¤º" class="headerlink" title="æˆæœå±•ç¤º"></a>æˆæœå±•ç¤º</h3><p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1fgv9zutcveg30rr0i9jwo.gif" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ”¶è—åŠŸèƒ½ä¸ç‚¹èµåŠŸèƒ½çš„å®ä½œååˆ†ç±»ä¼¼ï¼Œæœ¬æ–‡ä»¥è´­ç‰©è½¦æ•™ç¨‹å®ä½œæ”¶è—åŠŸèƒ½ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;h3 id=&quot;æ–¹æ³•ä¸€ï¼š&quot;&gt;&lt;a href=&quot;#æ–¹æ³•ä¸€ï¼š&quot; class=&quot;headerlink&quot; title=&quot;æ–¹æ³•ä¸€ï¼š&quot;&gt;&lt;/a&gt;æ–¹æ³•ä¸€ï¼š&lt;/h3&gt;&lt;h5 id=&quot;step1&quot;&gt;&lt;a href=
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>åˆ©ç”¨ransackåšæœç´¢åŠŸèƒ½</title>
    <link href="http://yoursite.com/2017/09/07/%E5%88%A9%E7%94%A8ransack%E5%81%9A%E6%90%9C%E7%B4%A2%E5%8A%9F%E8%83%BD/"/>
    <id>http://yoursite.com/2017/09/07/åˆ©ç”¨ransackåšæœç´¢åŠŸèƒ½/</id>
    <published>2017-09-06T16:27:42.000Z</published>
    <updated>2017-09-06T16:29:27.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬ç¯‡æ•™ç¨‹åŸºäºè‡ªå·±çš„ä¸€ä¸ªå°é¡¹ç›®ï¼Œç”¨æˆ·å¯ä»¥æœç´¢ç½‘ç«™ä¸Šå…¶ä»–ç”¨æˆ·å‘è¡¨è¿‡çš„æ–‡ç« ã€‚</p><h3 id="ç¬¬ä¸€æ­©ï¼š"><a href="#ç¬¬ä¸€æ­©ï¼š" class="headerlink" title="ç¬¬ä¸€æ­©ï¼š"></a>ç¬¬ä¸€æ­©ï¼š</h3><p><strong>å®‰è£…gem ransack</strong></p><blockquote><p>ransackä¼šç”¨æ•°æ®åº“çš„LIKEè¯­æ³•æ¥åšæœå¯»ï¼Œè™½ç„¶æ¯”è¾ƒæ–¹ä¾¿ï¼Œä½†å®ƒä¼šä¾æ¬¡æ£€æŸ¥èµ„æ–™æ˜¯å¦ç¬¦åˆï¼Œè€Œä¸ä¼šä½¿ç”¨æ•°æ®åº“çš„ç´¢å¼•ã€‚å¦‚æœæ•°æ®æ¯”è¾ƒåºå¤§çš„è¯ï¼Œåˆ©ç”¨ransackå°†ä¸ä¼šæ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ã€‚è¿™æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥å®‰è£…ä¸“é—¨çš„å…¨æ–‡æœç´¢å¼•æ“ï¼Œä¾‹å¦‚<a href="https://www.elastic.co/cn/" target="_blank" rel="external">Elasticsearch</a></p></blockquote><figure class="highlight ruby"><figcaption><span>Gemfile</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">+  gem <span class="string">'ransack'</span></div></pre></td></tr></table></figure><p><code>$ bundle</code>ï¼Œé‡å¯ rails s</p><h3 id="ç¬¬äºŒæ­©"><a href="#ç¬¬äºŒæ­©" class="headerlink" title="ç¬¬äºŒæ­©"></a>ç¬¬äºŒæ­©</h3><p><strong>controllerä¸configçš„è®¾å®š</strong><br>1ã€è®¾ç½®è·¯ç”±<br><figure class="highlight ruby"><figcaption><span>config/routes.rb</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">Rails.application.routes.draw <span class="keyword">do</span></div><div class="line">  devise_for <span class="symbol">:users</span></div><div class="line">  resources <span class="symbol">:posts</span> <span class="keyword">do</span></div><div class="line"> +   collection <span class="keyword">do</span>    <span class="comment">#æˆ‘ä»¬ä¼šæœç´¢å‡ºæ‰€æœ‰ç¬¦åˆå…³é”®å­—çš„æ–‡ç« ï¼Œç»“æœä¸ºå¤æ•°ï¼Œå› æ­¤ç”¨collectionï¼Œè€Œä¸æ˜¯member</span></div><div class="line"> +     get <span class="symbol">:search</span></div><div class="line"> +   <span class="keyword">end</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span>  </div><div class="line"><span class="string">``</span><span class="string">`  </span></div><div class="line"><span class="string">2ã€ è®¾ç½®controller</span></div><div class="line"><span class="string">ä¸»è¦è®¾ç½®é€šè¿‡å“ªäº›å…³é”®è¯è¿›è¡Œæœç´¢ã€‚</span></div><div class="line"><span class="string">`</span><span class="string">``</span>ruby app/controllers/posts_controller.rb</div><div class="line">  <span class="class"><span class="keyword">class</span> <span class="title">PostsController</span> &lt; ApplicationController</span></div><div class="line">    before_action <span class="symbol">:validate_search_key</span>, <span class="symbol">only:</span> [<span class="symbol">:search</span>]</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">search</span></span></div><div class="line">      <span class="keyword">if</span> @query_string.present?</div><div class="line">        @posts = search_params    <span class="comment">#æœç´¢postçš„å…³é”®è¯</span></div><div class="line">      <span class="keyword">end</span></div><div class="line">    <span class="keyword">end</span></div><div class="line"></div><div class="line">    protected  <span class="comment"># æ”¾åœ¨æœ€å</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate_search_key</span></span></div><div class="line">       <span class="comment"># gsub æ˜¯Rubyä¸­æ­£åˆ™è¡¨è¾¾å¼çš„æ–¹æ³•ï¼Œå®ƒä¼šåˆ‡æ¢æ‰€æœ‰åŒ¹é…åˆ°çš„éƒ¨åˆ†</span></div><div class="line">       @query_string = params[<span class="symbol">:q</span>].gsub(<span class="regexp">/\\|\'|\/|\?/</span>, <span class="string">""</span>)<span class="keyword">if</span> params[<span class="symbol">:q</span>].present?  </div><div class="line">    <span class="keyword">end</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">search_params</span>      </span></div><div class="line">      Post.ransack(&#123;<span class="symbol">:title_or_content_cont</span> =&gt; @query_string&#125;).result(<span class="symbol">distinct:</span> <span class="literal">true</span>)</div><div class="line">      <span class="comment">#titleä¸contentæ˜¯postçš„ä¸¤ä¸ªæ ä½ï¼Œè€Œæˆ‘ä»¬çš„å…³é”®è¯å‡ºè‡ªè¿™é‡Œ</span></div><div class="line">      <span class="keyword">end</span></div><div class="line">  <span class="keyword">end</span></div></pre></td></tr></table></figure></p><h3 id="ç¬¬ä¸‰æ­©"><a href="#ç¬¬ä¸‰æ­©" class="headerlink" title="ç¬¬ä¸‰æ­©"></a>ç¬¬ä¸‰æ­©</h3><p><strong>viewsçš„è®¾å®š</strong><br>1ã€å¯¼èˆªæ çš„æ˜¾ç¤º<br><figure class="highlight ruby"><figcaption><span>app/views/common/_navbar.html.erb</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"> &lt;div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1"&gt;</div><div class="line"> +  &lt;ul class="nav navbar-nav"&gt;</div><div class="line"> +    &lt;li&gt;</div><div class="line"> +        &lt;div class="form-group form-inline search-bar"&gt;</div><div class="line"> +          &lt;%= render <span class="symbol">:partial</span> =&gt; <span class="string">"posts/search_bar"</span>%&gt;</div><div class="line"> +       &lt;<span class="regexp">/div&gt;</span></div><div class="line"><span class="regexp"> +      &lt;/li</span>&gt;</div><div class="line"> +  &lt;<span class="regexp">/ul&gt;</span></div><div class="line"><span class="regexp"> â€¦â€¦ ç•¥</span></div><div class="line"><span class="regexp">&lt;/div</span>&gt;</div></pre></td></tr></table></figure></p><p>æ‰§è¡Œ<code>$ touch app/views/posts/_search_bar.html.erb</code>,å¹¶ç¼–è¾‘<br><figure class="highlight ruby"><figcaption><span>app/views/posts/_search_bar.html.erb</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"> &lt;div class="row"&gt;</div><div class="line">  &lt;div class="col-sm-9 col-lg-8 col-lg-offset-2"&gt;</div><div class="line">    &lt;%= form_tag search_posts_path, <span class="symbol">:class</span> =&gt; <span class="string">"posts-search-form"</span>, <span class="symbol">:method</span> =&gt; <span class="symbol">:get</span> <span class="keyword">do</span> %&gt;</div><div class="line">      &lt;div class="input-group"&gt;</div><div class="line">        &lt;input type="text" class="form-control search-bar-input" name="q" value="&lt;%= params[:q] %&gt;" placeholder="å…³é”®è¯"&gt;</div><div class="line">        &lt;span class="input-group-btn"&gt;</div><div class="line">          &lt;button type="submit" class="btn btn-default search-bar-submit"&gt;</div><div class="line">            &lt;span class="glyphicon glyphicon-search"&gt;&lt;/span&gt;</div><div class="line">          &lt;<span class="regexp">/button&gt;</span></div><div class="line"><span class="regexp">        &lt;/span</span>&gt;</div><div class="line">      &lt;<span class="regexp">/div&gt;</span></div><div class="line"><span class="regexp">    &lt;% end %&gt;</span></div><div class="line"><span class="regexp">  &lt;/div</span>&gt;</div><div class="line">&lt;<span class="regexp">/div&gt;</span></div></pre></td></tr></table></figure></p><p><strong>2.æœç´¢åé¦ˆé¡µé¢</strong><br>æ–°å¢ <code>app/views/posts/search.html.erb</code><br><figure class="highlight ruby"><figcaption><span>app/views/posts/search.html.erb</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">&lt;div class="minHeight1000 bg-gray"&gt;</div><div class="line">  &lt;div class="search-page w1200 pt30 bc"&gt;</div><div class="line">      &lt;% <span class="keyword">if</span> @posts.present? %&gt;</div><div class="line">        &lt;h5 class="collection search-count"&gt;å·²ä¸ºæ‚¨æ‰¾åˆ°&lt;%= @posts.count %&gt;ç¯‡ç›¸å…³æ–‡ç« &lt;/h5&gt;</div><div class="line">      &lt;% <span class="keyword">else</span> %&gt;</div><div class="line">        &lt;p class="tc mt100"&gt;æœªæœç´¢åˆ°ä»»ä½•æ–‡ç« ï¼Œè¦ä¸æ¢ä¸ªå…³é”®è¯è¯•è¯•ï¼Ÿ&lt;/p&gt;</div><div class="line">      &lt;% <span class="keyword">end</span> %&gt;</div><div class="line">  &lt;<span class="regexp">/div&gt;</span></div><div class="line"><span class="regexp"></span></div><div class="line"><span class="regexp">  &lt;div class="container"&gt;</span></div><div class="line"><span class="regexp">  &lt;% @posts.each do |post| %&gt;</span></div><div class="line"><span class="regexp"></span></div><div class="line"><span class="regexp">    &lt;div class="panel panel-default"&gt;</span></div><div class="line"><span class="regexp">      &lt;div class="panel-body"&gt;</span></div><div class="line"><span class="regexp">        &lt;%= post.title %&gt;</span></div><div class="line"><span class="regexp">        &lt;br/</span>&gt;</div><div class="line">        &lt;br/&gt;</div><div class="line">        &lt;span id="psot-thumbsup-&lt;%= post.id%&gt;" class=" label label-success"&gt;&lt;%= post.likes.count%&gt;ğŸ‘&lt;/span&gt;</div><div class="line">        &lt;div class="text-right"&gt;</div><div class="line"></div><div class="line">          &lt;% <span class="keyword">if</span> !current_user.is_collect_of?(post) %&gt;</div><div class="line">            &lt;%= link_to(<span class="string">"æ”¶è—"</span>, collect_post_path(post), <span class="symbol">method:</span> <span class="symbol">:post</span>, <span class="class"><span class="keyword">class</span>: "<span class="title">btn</span> <span class="title">btn</span>-<span class="title">sm</span>") %&gt;</span></div><div class="line">          &lt;% <span class="keyword">else</span> %&gt;</div><div class="line">            &lt;%= link_to(<span class="string">"å–æ¶ˆæ”¶è—"</span>, uncollect_post_path(post), <span class="symbol">method:</span> <span class="symbol">:post</span>, <span class="class"><span class="keyword">class</span>: "<span class="title">btn</span> <span class="title">btn</span>-<span class="title">sm</span>") %&gt;</span></div><div class="line">          &lt;% <span class="keyword">end</span> %&gt;</div><div class="line">        &lt;<span class="regexp">/div&gt;</span></div><div class="line"><span class="regexp">      &lt;/div</span>&gt;</div><div class="line"></div><div class="line">    &lt;<span class="regexp">/div&gt;</span></div><div class="line"><span class="regexp"></span></div><div class="line"><span class="regexp">  &lt;% end %&gt;</span></div><div class="line"><span class="regexp">  &lt;/div</span>&gt;</div><div class="line">&lt;<span class="regexp">/div&gt;</span></div></pre></td></tr></table></figure></p><p>æ•ˆæœå›¾<br>   <img src="https://ws3.sinaimg.cn/large/006tNc79gy1fhcsoezlm4j31bw0g9gmw.jpg" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ¬ç¯‡æ•™ç¨‹åŸºäºè‡ªå·±çš„ä¸€ä¸ªå°é¡¹ç›®ï¼Œç”¨æˆ·å¯ä»¥æœç´¢ç½‘ç«™ä¸Šå…¶ä»–ç”¨æˆ·å‘è¡¨è¿‡çš„æ–‡ç« ã€‚&lt;/p&gt;
&lt;h3 id=&quot;ç¬¬ä¸€æ­©ï¼š&quot;&gt;&lt;a href=&quot;#ç¬¬ä¸€æ­©ï¼š&quot; class=&quot;headerlink&quot; title=&quot;ç¬¬ä¸€æ­©ï¼š&quot;&gt;&lt;/a&gt;ç¬¬ä¸€æ­©ï¼š&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;å®‰è£…gem ransa
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>my_first_post</title>
    <link href="http://yoursite.com/2017/09/06/my-first-post/"/>
    <id>http://yoursite.com/2017/09/06/my-first-post/</id>
    <published>2017-09-06T09:42:31.000Z</published>
    <updated>2017-09-06T09:42:46.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ­ªè„–å­é¹…</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ­ªè„–å­é¹…&lt;/p&gt;

      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://yoursite.com/2017/09/06/hello-world/"/>
    <id>http://yoursite.com/2017/09/06/hello-world/</id>
    <published>2017-09-06T09:33:31.000Z</published>
    <updated>2017-09-06T09:33:31.000Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.
      
    
    </summary>
    
    
  </entry>
  
</feed>
